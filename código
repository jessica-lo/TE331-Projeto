/* Código implementado pelos discentes Jessica Lo e Lucas Vitkoski, como parte do projeto da disciplina TE331-Instrumentação Eletrônica.
 * Controle da altura de um objeto dentro de um tubo, por meio da alteração
 * do valor do sinal PWM pelo monitor serial;
 * Leitura da distância do objeto pelo sensor VL53l0X
*/

#include "Adafruit_VL53L0X.h"

byte PWM=0;

Adafruit_VL53L0X lox = Adafruit_VL53L0X();
 
void setup() {
  Serial.begin(115200);
 
  // espera até o monitor serial abrir
  while (! Serial) {
    delay(1);
  }

  if (!lox.begin(VL53L0X_I2C_ADDR, false, &Wire, lox.VL53L0X_SENSE_HIGH_SPEED)) {
    Serial.println(F("Failed to boot VL53L0X"));
    while(1);
  }

  pinMode(3, OUTPUT);
  analogWrite(3, 0);
}
 
 
void loop() {
  VL53L0X_RangingMeasurementData_t medida;
 
  lox.rangingTest(&medida, false); // mudar para 'true' caso deseje acessar os dados de depuração
 
  if (medida.RangeStatus != 4) { 
    Serial.println(medida.RangeMilliMeter);
  } else {
    Serial.println(" out of range ");
  }

  if (Serial.available() > 0) {  //verifica se há dados na serial 
    PWM = Serial.parseInt(); //lê caracteres ASCII da serial e converte em um número inteiro
    PWM = constrain(PWM, 0, 255);  //limita os valores da variável PWM entre 0 a 255
    analogWrite (3, PWM);  //atribui o valor do PWM à porta de saída 3
    while(Serial.available()) Serial.read();
  }
  //Serial.print(PWM);
  //Serial.print("\n");
}
